<html><head><title>Nest - Cluster Failover</title><meta http-equiv="cache-control" content="no-cache"/><meta http-equiv="pragma" content="no-cache"/><meta http-equiv="content-type" content="text/html;charset=utf-8"/><meta http-equiv="expires" content="0"/><meta name="description" content="elasticsearch"/><meta name="keywords" content="nest, elasticsearch, .net, client"/><meta name="author" content="martijn laarman"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<script src="/scripts/html5shiv.js"></script><link rel="stylesheet" type="text/css" href="/styles/normalize.css"/><link rel="stylesheet" type="text/css" href="/styles/layout.css"/><link rel="stylesheet" type="text/css" href="/styles/pygments.css"/><link rel="stylesheet" type="text/css" href="/styles/pygments.css"/><link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css"/><link href="//fonts.googleapis.com/css?family=Ubuntu+Mono|Open+Sans" rel="stylesheet" type="text/css"/><link href="/prettify/prettify.css" type="text/css" rel="stylesheet"/><link href="/prettify/sunburst.css" type="text/css" rel="stylesheet"/><script src="//code.jquery.com/jquery.min.js" type="text/javascript"></script><script type="text/javascript" src="/prettify/prettify.js"></script><script type="text/javascript" src="/prettify/fix_code_tags.js"></script></head><body><div class="wrapper"><header class="header"><div class="actions"><iframe src="//ghbtns.com/github-btn.html?user=elasticsearch&amp;repo=elasticsearch-net&amp;type=fork&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe><iframe src="//ghbtns.com/github-btn.html?user=elasticsearch&amp;repo=elasticsearch-net&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe></div><img src="/images/elasticsearch-net-nuget-icon.png" width="48" height="48"/><h1>Elasticsearch.Net </h1><p>Documentation</p></header><div class="divide"></div><div class="middle"><div class="container"><main class="content"><h1 id="connection-pooling-cluster-failover">Connection pooling &amp; Cluster failover</h1>
<p>One of the major benefits of Elasticsearch is that it can handle dying and respawning  nodes. 
As long as enough nodes agree that the cluster is healthy, the cluster will continue to operate.
<code>Elasticsearch.Net</code> comes with builtin support for handle falling over to a different node when the requested node failed.</p>
<h2 id="configuring">Configuring</h2>
<p>Configuring how the registered <code>IConnectionPool</code> should behave happens on the <code>IConnectionConfigurationValues</code> passed to client 
<a href="/elasticsearch-net/connecting.html">see the section on connecting </a></p>
<pre><code>var settings = new ConnectionConfiguration(connectionPool)
    .SniffOnConnectionFault(false)
    .SniffOnStartup(false)
    .SniffLifeSpan(TimeSpan.FromMinutes(1));
</code></pre><h3 id="sniffonconnectionfault">SniffOnConnectionFault</h3>
<p>Should the connection pool resniff the cluster state everytime an operation on a node throws an exception or a faulty http status code.
Defaults to true.</p>
<h3 id="sniffonstartup">SniffOnStartup</h3>
<p>Should the connection pool sniff the cluster state the first time its instantiated. Defaults to true.</p>
<h3 id="snifflifespan">SniffLifeSpan</h3>
<p>When set will cause the connectionpool to resniff whenever it notices the last sniff information happened too long ago. Defaults to null.</p>
<h3 id="setdeadtimeout">SetDeadTimeout</h3>
<p>Sets the timeout before a node is retried. The default <code>DateTimeProvider</code> will increment this timeout exponentially based on the number of attempts.</p>
<h3 id="setmaxdeadtimeout">SetMaxDeadTimeout</h3>
<p>Sets the maximum time a node may be marked dead.</p>
<h3 id="disableping">DisablePing</h3>
<p>By default before a previously dead node is retried a short ping will be sent to the node to make sure the node will respond. 
The reason for a separate call is that a ping will call an elasticsearch endpoint that won&#39;t stress the JVM. If a node is having issues retrying a possible heavy search operation on it might cause the request to fail later rather then asap. This setting allows you to disable these pings before retries.</p>
<h3 id="maximumretries">MaximumRetries</h3>
<p>By default an <code>IConnectionPool</code> itself will decide how many times to retry (usually all the registered nodes) if you wish to 
limit this you can explicitly tell the connection pool to never retry more than <code>retries</code>.</p>
<h2 id="sniffingconnectionpool">SniffingConnectionPool</h2>
<p>This <code>IConnectionPool</code> implementation will <code>sniff</code> the cluster state on the passed seed nodes to find all the alive nodes in the cluster. It will round robin requests over all the alive nodes it knows about. </p>
<pre><code>var pool = new SniffingConnectionPool(seedUris);
</code></pre><h2 id="staticconnectionpool">StaticConnectionPool</h2>
<p>This <code>IConnectionPool</code> implementation will round robin over the provided nodes. When nodes are dead it will mark it dead with an incremental timeout before 
retrying requests on that node. When all the known nodes are marked dead an operation will be tried once on a random node from the list. </p>
<p>The difference between this implementation and <code>SniffingConnectionPool</code> is that this implementation effectively treats the <code>Sniff()</code> call as a 
<a href="http://en.wikipedia.org/wiki/Noop">NOOP</a></p>
<pre><code>var pool = new StaticConnectionPool(seedUris);
</code></pre></main></div><aside class="left-sidebar"><aside id="menu"><ul><li><h4><a href="/">Home</a><a href="/contributing.html">Contributing</a><a href="/building.html">Building</a><a href="/breaking-changes.html">1.0 Breaking Changes</a><a href="https://github.com/elasticsearch/elasticsearch-net/releases">Release Notes</a></h4></li></ul><ul id="elasticsearch-net"><h4 class="title">Elasticsearch.Net</h4><ul><li><a href="/elasticsearch-net/quick-start.html">Quick Start</a></li><li><a href="/elasticsearch-net/connecting.html">Connecting</a></li><li><a href="/elasticsearch-net/security.html">Security</a></li><li><a href="/elasticsearch-net/cluster-failover.html" class="selected">Cluster failover</a></li><li><a href="/elasticsearch-net/building-requests.html">Building requests</a></li><li><a href="/elasticsearch-net/handling-responses.html">Handling responses</a></li><li><a href="/elasticsearch-net/errors.html">Errors</a></li></ul></ul><ul id="nest"><h4 class="title">NEST</h4><ul><li><a href="/nest/quick-start.html">Quick Start</a></li><li><a href="/nest/connecting.html">Connecting</a></li><li><a href="/nest/index-type-inference.html">Type/Index Inference</a></li><li><a href="/nest/handling-responses.html">Handling responses</a></li><li><a href="/nest/writing-queries.html">Writing queries</a></li><li><a href="/nest/tips-tricks.html">Tips & Tricks</a></li></ul><li><h4><a href="/nest/core/"><i class="fa fa-chevron-right"></i>Core</a></h4></li><li><h4><a href="/nest/indices/aliases.html"><i class="fa fa-chevron-right"></i>Indices</a></h4></li><li><h4><a href="/nest/cluster/health.html"><i class="fa fa-chevron-right"></i>Cluster</a></h4></li><li><h4><a href="/nest/search/basics.html"><i class="fa fa-chevron-right"></i>Search</a></h4></li><li><h4><a href="/nest/aggregations/handling.html"><i class="fa fa-chevron-right"></i>Aggregations</a></h4></li><li><h4><a href="/nest/facets/handling.html"><i class="fa fa-chevron-right"></i>Facets</a></h4></li></ul></aside></aside></div><footer class="footer"></footer></div></body></html>